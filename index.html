<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>NEO Mobile Online ‚Ä¢ Address Forge & Live Board</title>
<meta name="color-scheme" content="dark light">
<!-- Firebase (Compat for widest mobile support) -->
<script defer src="https://www.gstatic.com/firebasejs/11.6.1/firebase-app-compat.js"></script>
<script defer src="https://www.gstatic.com/firebasejs/11.6.1/firebase-auth-compat.js"></script>
<script defer src="https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore-compat.js"></script>
<style>
  :root{
    --bg:#0c111b;--bg2:#0a0f18;--panel:#141b26;--muted:#7a8699;--text:#e8f0ff;--brand:#10b3d6;--brand2:#7ddc1f;--danger:#ff5a5f;
    --ok:#23d18b;--warn:#f1c40f;--radius:16px;--shadow:0 10px 28px rgba(0,0,0,.35);
  }
  html,body{height:100%}
  body{
    margin:0;background:
      radial-gradient(700px 380px at 110% -10%, rgba(16,179,214,.18), transparent 60%),
      radial-gradient(700px 380px at -10% 110%, rgba(125,220,31,.15), transparent 60%),
      linear-gradient(180deg,var(--bg) 0%, var(--bg2) 100%);
    color:var(--text);
    font:16px/1.5 system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans Thai", "Noto Sans", sans-serif;
    -webkit-tap-highlight-color: transparent;
  }
  .max{max-width:680px;margin:0 auto}
  .topbar{position:sticky;top:0;z-index:20;padding:12px;backdrop-filter:saturate(1.2) blur(8px);
    background:linear-gradient(180deg, rgba(12,17,27,.95), rgba(12,17,27,.75));border-bottom:1px solid rgba(255,255,255,.06)}
  .brand{display:flex;gap:10px;align-items:center}
  .logo{width:38px;height:38px;border-radius:12px;background:linear-gradient(135deg,var(--brand),var(--brand2));
    display:grid;place-items:center;font-weight:900;color:#001219}
  .subtitle{font-size:11px;color:var(--muted);letter-spacing:.08em;text-transform:uppercase}
  .container{padding:14px 14px 84px}
  .panel{background:var(--panel);border:1px solid rgba(255,255,255,.08);border-radius:var(--radius);box-shadow:var(--shadow)}
  .pad{padding:14px}
  .grid{display:grid;gap:12px}
  .g2{grid-template-columns:1fr 1fr}
  .muted{color:var(--muted)}
  .btn{appearance:none;border:0;border-radius:14px;padding:13px 14px;font-weight:800;background:#1a2433;color:#dff3ff}
  .btn:active{transform:translateY(1px)}
  .btn-primary{background:linear-gradient(90deg,var(--brand),#209ee2);color:#001219}
  .btn-ghost{background:#0f1520;color:#d0eaff;border:1px solid rgba(255,255,255,.12)}
  .btn-danger{background:#2a1a1d;color:#ffd6d6;border:1px solid rgba(255,90,95,.35)}
  .field{display:flex;flex-direction:column;gap:6px}
  input,select,textarea{
    width:100%;background:#0f1520;color:#eaf2ff;border:1px solid rgba(255,255,255,.12);border-radius:12px;padding:12px;font:inherit
  }
  textarea{min-height:110px;resize:vertical}
  .row{display:flex;gap:10px;align-items:center}
  .wrap{display:flex;flex-wrap:wrap;gap:8px}
  .stat{display:flex;gap:8px;align-items:center;background:#0f1520;border:1px solid rgba(255,255,255,.08);border-radius:12px;padding:10px}
  .stat .num{font-weight:900}
  .result{min-height:120px;font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, "JetBrains Mono", monospace;
    padding:12px;background:#0f1520;border-radius:12px;border:1px solid rgba(255,255,255,.08)}
  .tip{font-size:12px;color:var(--muted)}
  .chip{display:inline-flex;align-items:center;gap:6px;background:#112030;color:#bfe9ff;border:1px solid rgba(255,255,255,.08);
    border-radius:999px;padding:5px 10px;font-size:12px}
  .list{display:flex;flex-direction:column;gap:10px;max-height:220px;overflow:auto}
  .item{padding:10px;background:#0f1520;border:1px solid rgba(255,255,255,.08);border-radius:12px}
  .item .meta{display:flex;justify-content:space-between;gap:8px;color:var(--muted);font-size:11px;margin-top:6px}
  .divider{height:1px;background:linear-gradient(90deg,transparent,rgba(255,255,255,.12),transparent);margin:8px 0}
  .bottomnav{
    position:fixed;left:0;right:0;bottom:0;z-index:30;padding:10px 12px;background:rgba(12,17,27,.96);backdrop-filter:blur(8px);
    border-top:1px solid rgba(255,255,255,.06);display:grid;grid-template-columns:repeat(3,1fr);gap:10px
  }
  .tabbtn{border-radius:12px;padding:10px;background:#0f1520;color:#cfe8ff;border:1px solid rgba(255,255,255,.06)}
  .tabbtn.active{background:linear-gradient(90deg,var(--brand),#1ea8df);color:#001219;font-weight:900}
  .hidden{display:none}
  .toast{position:fixed;right:12px;bottom:76px;background:#0e2530;color:#e6f7ff;border:1px solid rgba(255,255,255,.12);
    padding:10px 12px;border-radius:10px;opacity:0;transform:translateY(10px);transition:.25s;z-index:40}
  .toast.show{opacity:1;transform:translateY(0)}
  .mark{background:#ffe172;color:#1b2436;padding:0 4px;border-radius:6px;font-weight:900}
  .pill{border-radius:999px;padding:4px 10px;background:#152034;border:1px solid rgba(255,255,255,.1)}
  .kbd{border:1px solid rgba(255,255,255,.25);background:#132030;border-radius:8px;padding:1px 6px;font-size:12px}
</style>
</head>
<body>
  <!-- Top -->
  <header class="topbar">
    <div class="max brand">
      <div class="logo">N</div>
      <div>
        <div style="font-weight:900;font-size:17px">NEO Mobile Online</div>
        <div class="subtitle">Address Forge & Live Firestore Board</div>
      </div>
    </div>
  </header>

  <main class="container max">
    <!-- TAB: Generator -->
    <section id="tab-gen" class="grid" aria-live="polite">
      <div class="panel pad grid">
        <div class="row" style="justify-content:space-between">
          <div style="font-weight:900;font-size:18px">üîê ‡∏ï‡∏±‡∏ß‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏•‡∏±‡∏ö (One-Line)</div>
          <div class="wrap">
            <span class="pill tip">‡∏Ñ‡∏µ‡∏¢‡πå‡∏•‡∏±‡∏î: <span class="kbd">G</span> ‡∏™‡∏∏‡πà‡∏° ‚Ä¢ <span class="kbd">C</span> ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å</span>
          </div>
        </div>

        <div class="grid g2">
          <label class="field">
            <span class="tip">‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà</span>
            <select id="addressSelect"></select>
          </label>
          <label class="field">
            <span class="tip">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏û‡∏£‡∏≤‡∏á</span>
            <select id="obfuscationSelect">
              <option value="low">‡∏ï‡πà‡∏≥ ‚Äî ‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢</option>
              <option value="medium" selected>‡∏Å‡∏•‡∏≤‡∏á ‚Äî ‡∏™‡∏°‡∏î‡∏∏‡∏•</option>
              <option value="high">‡∏™‡∏π‡∏á ‚Äî ‡∏û‡∏£‡∏≤‡∏á‡∏´‡∏ô‡∏±‡∏Å</option>
              <option value="extreme">‡∏™‡∏∏‡∏î‡∏Ç‡∏±‡πâ‡∏ô ‚Äî ‡πÄ‡∏Å‡∏∑‡∏≠‡∏ö‡πÑ‡∏°‡πà‡∏≠‡πà‡∏≤‡∏ô‡∏≠‡∏≠‡∏Å</option>
            </select>
          </label>
          <label class="field">
            <span class="tip">‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç</span>
            <select id="digitMode">
              <option value="mixed" selected>‡∏ú‡∏™‡∏° (‡πÑ‡∏ó‡∏¢/‡∏≠‡∏≤‡∏£‡∏ö‡∏¥‡∏Å)</option>
              <option value="thai">‡πÄ‡∏•‡∏Ç‡πÑ‡∏ó‡∏¢‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
              <option value="arabic">‡πÄ‡∏•‡∏Ç‡∏≠‡∏≤‡∏£‡∏ö‡∏¥‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
            </select>
          </label>
          <div class="field">
            <div class="row" style="justify-content:space-between">
              <span class="tip">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡∏Ñ‡∏±‡πà‡∏ô (‡πÑ‡∏°‡πà‡∏Ç‡∏∂‡πâ‡∏ô‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡πÉ‡∏´‡∏°‡πà)</span>
              <label class="tip row" style="gap:6px">
                <input id="nbspToggle" type="checkbox"> ‡πÉ‡∏ä‡πâ&nbsp;NBSP
              </label>
            </div>
            <input id="spaceCount" type="range" min="1" max="12" value="6" />
            <div class="row" style="justify-content:space-between">
              <span class="chip">‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á: <span id="spaceSample" style="background:#22324a;padding:2px 8px;border-radius:8px">______</span></span>
              <label class="tip row" style="gap:6px">
                <input id="randSpace" type="checkbox"> ‡∏™‡∏∏‡πà‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á
              </label>
            </div>
          </div>
        </div>

        <div class="wrap">
          <label class="chip"><input id="fuzzyLabels" type="checkbox" checked> ‡πÉ‡∏ä‡πâ‡∏â‡∏•‡∏≤‡∏Å‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏û‡∏µ‡πâ‡∏¢‡∏ô</label>
          <label class="chip"><input id="punctToggle" type="checkbox" checked> ‡πÅ‡∏ó‡∏£‡∏Å‡∏™‡∏±‡∏ç‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå‡∏™‡∏∏‡πà‡∏°</label>
          <label class="chip"><input id="zwsToggle" type="checkbox"> ‡πÅ‡∏ó‡∏£‡∏Å ZWSP (‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô)</label>
        </div>

        <div class="row" style="gap:8px;flex-wrap:wrap">
          <button id="generateBtn" class="btn btn-primary" style="flex:1">üé≤ ‡∏™‡∏∏‡πà‡∏°</button>
          <button id="copyBtn" class="btn btn-ghost" style="flex:1">üìã ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å</button>
          <button id="saveBtn" class="btn btn-ghost" style="flex:1">‚¨áÔ∏è ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ü‡∏•‡πå</button>
          <button id="cleanBtn" class="btn btn-ghost" style="flex:1">üßΩ ‡∏•‡πâ‡∏≤‡∏á‡∏™‡∏±‡∏ç‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå/ZWSP</button>
        </div>

        <div class="row" style="gap:10px">
          <div class="stat"><span class="muted">‡∏™‡∏£‡πâ‡∏≤‡∏á</span> <span class="num" id="generateCount">0</span></div>
          <div class="stat"><span class="muted">‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å</span> <span class="num" id="copyCount">0</span></div>
          <div class="stat"><span class="muted">‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö</span> <span class="num" id="currentVariation">A1</span></div>
          <div class="stat"><span class="muted">‡πÄ‡∏ß‡∏•‡∏≤</span> <span class="num" id="generationTime">‚Äî</span></div>
        </div>

        <div class="divider"></div>

        <div>
          <div class="row" style="justify-content:space-between">
            <span style="font-weight:700">‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå (‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡πÄ‡∏î‡∏µ‡∏¢‡∏ß)</span>
            <small class="tip">‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß‡∏ß‡∏≤‡∏á‡πÉ‡∏ô‡πÅ‡∏≠‡∏õ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢</small>
          </div>
          <div id="resultDisplay" class="result" style="margin-top:8px"></div>
        </div>

        <div>
          <div class="row" style="justify-content:space-between">
            <span style="font-weight:700">üìö ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</span>
            <button id="exportCsv" class="btn btn-ghost" style="padding:8px 10px">üì§ ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å CSV</button>
          </div>
          <div id="historyContainer" class="list"><div class="tip">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</div></div>
        </div>
      </div>

      <div class="panel pad">
        <div style="font-weight:700">üß™ ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏â‡∏•‡∏≤‡∏Å (‡∏õ‡∏Å‡∏ï‡∏¥/‡πÄ‡∏û‡∏µ‡πâ‡∏¢‡∏ô)</div>
        <div id="labelPreview" class="wrap" style="margin-top:8px"></div>
      </div>
    </section>

    <!-- TAB: Board (Firestore) -->
    <section id="tab-board" class="grid hidden">
      <div class="panel pad grid">
        <div class="row" style="justify-content:space-between">
          <div style="font-weight:900;font-size:18px">üí¨ ‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</div>
          <span class="pill tip">Realtime Firestore</span>
        </div>

        <div class="grid g2">
          <label class="field">
            <span class="tip">‡∏£‡∏´‡∏±‡∏™‡∏ö‡∏≠‡∏£‡πå‡∏î (‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏≠‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏¢‡∏Å‡∏´‡πâ‡∏≠‡∏á)</span>
            <input id="boardIdInput" placeholder="‡πÄ‡∏ä‡πà‡∏ô: my-team-01">
          </label>
          <div class="field">
            <span class="tip">‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠</span>
            <div class="row">
              <button id="applyBoard" class="btn btn-primary" style="flex:1">‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠/‡∏™‡∏•‡∏±‡∏ö‡∏ö‡∏≠‡∏£‡πå‡∏î</button>
              <button id="shareBoard" class="btn btn-ghost">‡πÅ‡∏ä‡∏£‡πå‡∏•‡∏¥‡∏á‡∏Å‡πå</button>
            </div>
          </div>
        </div>

        <div class="grid">
          <label class="field">
            <span class="tip">‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠ (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)</span>
            <input id="titleInput" maxlength="120" placeholder="‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠">
          </label>
          <label class="field">
            <span class="tip">‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</span>
            <textarea id="messageInput" maxlength="1000" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà..."></textarea>
          </label>
          <div class="row" style="justify-content:space-between">
            <span class="tip"><span id="charLeft">1000</span> ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠</span>
            <div class="row">
              <button id="postBtn" class="btn btn-primary">‡πÇ‡∏û‡∏™‡∏ï‡πå</button>
              <button id="clearCompose" class="btn btn-ghost">‡∏•‡πâ‡∏≤‡∏á</button>
            </div>
          </div>
        </div>
      </div>

      <div class="panel pad grid">
        <div class="row" style="justify-content:space-between">
          <div style="font-weight:700">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏û‡∏™‡∏ï‡πå</div>
          <div class="row">
            <input id="searchMsg" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤..." style="width:160px">
            <label class="chip"><input id="onlyMine" type="checkbox"> ‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</label>
          </div>
        </div>
        <div id="loadingBoard" class="tip">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠...</div>
        <div id="messages" class="list"></div>
      </div>
    </section>

    <!-- TAB: Settings -->
    <section id="tab-settings" class="grid hidden">
      <div class="panel pad grid">
        <div style="font-weight:900;font-size:18px">‚öôÔ∏è ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà (‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á‡πÄ‡∏≠‡∏á)</div>
        <div class="tip">‡πÄ‡∏û‡∏¥‡πà‡∏°/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå ‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏ï‡∏±‡∏ß‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô</div>
        <div class="grid g2">
          <label class="field"><span class="tip">‡∏Ñ‡∏µ‡∏¢‡πå‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå</span><input id="p_key" placeholder="‡πÄ‡∏ä‡πà‡∏ô: home2"></label>
          <label class="field"><span class="tip">‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà</span><input id="p_house" placeholder="62/37"></label>
          <label class="field"><span class="tip">‡∏ã‡∏≠‡∏¢</span><input id="p_soi" placeholder="‡∏•‡∏≤‡∏î‡∏Å‡∏£‡∏∞‡∏ö‡∏±‡∏á16"></label>
          <label class="field"><span class="tip">‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô</span><input id="p_village" placeholder="‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô..."></label>
          <label class="field"><span class="tip">‡∏ñ‡∏ô‡∏ô</span><input id="p_road" placeholder="‡∏•‡∏≤‡∏î‡∏Å‡∏£‡∏∞‡∏ö‡∏±‡∏á"></label>
          <label class="field"><span class="tip">‡∏ï‡∏≥‡∏ö‡∏•</span><input id="p_subdistrict" placeholder="‡∏£‡∏≤‡∏ä‡∏≤‡πÄ‡∏ó‡∏ß‡∏∞"></label>
          <label class="field"><span class="tip">‡∏≠‡∏≥‡πÄ‡∏†‡∏≠</span><input id="p_district" placeholder="‡∏ö‡∏≤‡∏á‡∏û‡∏•‡∏µ"></label>
          <label class="field"><span class="tip">‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</span><input id="p_province" placeholder="‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏õ‡∏£‡∏≤‡∏Å‡∏≤‡∏£"></label>
          <label class="field"><span class="tip">‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏õ‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå</span><input id="p_postal" placeholder="10540"></label>
          <label class="field"><span class="tip">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</span><input id="p_phone" placeholder="0961408164"></label>
        </div>
        <div class="row">
          <button id="addProfile" class="btn btn-primary">‡πÄ‡∏û‡∏¥‡πà‡∏°/‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå</button>
          <button id="delProfile" class="btn btn-danger">‡∏•‡∏ö‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå</button>
        </div>
        <div class="divider"></div>
        <div>
          <div style="font-weight:700">‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
          <div id="profileList" class="list" style="max-height:240px"></div>
        </div>
      </div>

      <div class="panel pad">
        <div style="font-weight:700">‚ÑπÔ∏è ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</div>
        <ul class="tip" style="margin:6px 0 0 18px">
          <li>‡πÇ‡∏´‡∏°‡∏î‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡∏ú‡πà‡∏≤‡∏ô HTTPS/‡πÇ‡∏î‡πÄ‡∏°‡∏ô‡∏´‡∏£‡∏∑‡∏≠ localhost</li>
          <li>‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏ä‡∏£‡πå‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏î‡πâ‡∏ß‡∏¢‡∏•‡∏¥‡∏á‡∏Å‡πå ?board=YOUR_ID</li>
          <li>‡πÇ‡∏Ñ‡πâ‡∏î‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πâ Firebase (Anonymous Auth + Firestore)</li>
        </ul>
      </div>
    </section>
  </main>

  <!-- Bottom Nav -->
  <nav class="bottomnav">
    <button class="tabbtn active" data-tab="gen">üîê ‡∏™‡∏£‡πâ‡∏≤‡∏á</button>
    <button class="tabbtn" data-tab="board">üí¨ ‡∏ö‡∏≠‡∏£‡πå‡∏î</button>
    <button class="tabbtn" data-tab="settings">‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</button>
  </nav>

  <div id="toast" class="toast">‚Äî</div>

<script>
/* ====== Helpers ====== */
const $ = s => document.querySelector(s);
const $$ = s => Array.from(document.querySelectorAll(s));
const toast = $('#toast');
function showToast(msg){ toast.textContent=msg; toast.classList.add('show'); clearTimeout(showToast.t); showToast.t=setTimeout(()=>toast.classList.remove('show'),1600); }
function rnd(a){ return a[Math.floor(Math.random()*a.length)] }
function zws(s){ return s.split('').join('\\u200b') }
function toThaiDigits(str){ return String(str).replace(/[0-9]/g,d=>'‡πê‡πë‡πí‡πì‡πî‡πï‡πñ‡πó‡πò‡πô'[d]) }
function toArabicDigits(str){ return String(str).replace(/[‡πê-‡πô]/g,d=>'0123456789'['‡πê‡πë‡πí‡πì‡πî‡πï‡πñ‡πó‡πò‡πô'.indexOf(d)]) }
function uid(){ return Math.random().toString(36).slice(2)+Math.random().toString(36).slice(2) }
function esc(s=''){ const p=document.createElement('p'); p.textContent=s; return p.innerHTML }

/* ====== Tabs ====== */
const tabs = {gen: $('#tab-gen'), board: $('#tab-board'), settings: $('#tab-settings')};
$$('.tabbtn').forEach(btn=>{
  btn.addEventListener('click', ()=>{
    $$('.tabbtn').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    const t=btn.dataset.tab; Object.entries(tabs).forEach(([k,el])=> el.classList.toggle('hidden', k!==t));
    window.scrollTo({top:0,behavior:'smooth'});
    localStorage.setItem('neo_tab', t);
  });
});
(function(){ const t=localStorage.getItem('neo_tab'); if(t&&tabs[t]) { $(`.tabbtn[data-tab="${t}"]`).click(); } })();

/* ====== Address Profiles (default + user) ====== */
const DEFAULT_PROFILES = {
  home: { houseNumber:"62/37",soi:"‡∏•‡∏≤‡∏î‡∏Å‡∏£‡∏∞‡∏ö‡∏±‡∏á16",village:"‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô‡πÑ‡∏ó‡∏¢‡∏™‡∏°‡∏∏‡∏ó‡∏£2",road:"‡∏•‡∏≤‡∏î‡∏Å‡∏£‡∏∞‡∏ö‡∏±‡∏á",subdistrict:"‡∏£‡∏≤‡∏ä‡∏≤‡πÄ‡∏ó‡∏ß‡∏∞",district:"‡∏ö‡∏≤‡∏á‡∏û‡∏•‡∏µ",province:"‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏õ‡∏£‡∏≤‡∏Å‡∏≤‡∏£",postalCode:"10540", phone:"0961408164" },
  alt1: { houseNumber:"22/4",soi:"‡πÉ‡∏à‡πÄ‡∏≠‡∏∑‡πâ‡∏≠ 2",village:"",road:"",subdistrict:"‡∏ö‡∏≤‡∏á‡∏Ç‡∏∞‡πÅ‡∏¢‡∏á",district:"",province:"‡∏õ‡∏ó‡∏∏‡∏°‡∏ò‡∏≤‡∏ô‡∏µ",postalCode:"12000", phone:"0946401569" }
};
const PROFILES_KEY = 'neo_profiles_v1';
function loadProfiles(){
  try { const u = JSON.parse(localStorage.getItem(PROFILES_KEY)||'{}'); return {...DEFAULT_PROFILES, ...u}; }
  catch { return {...DEFAULT_PROFILES}; }
}
function saveUserProfiles(all){
  const userOnly = {}; Object.entries(all).forEach(([k,v])=>{ if(!DEFAULT_PROFILES[k]) userOnly[k]=v; });
  localStorage.setItem(PROFILES_KEY, JSON.stringify(userOnly));
}

/* ====== Generator Data ====== */
const Labels = {
  house:['‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà','‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà','No.','#',''],
  phone:['‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå','Tel','‡πÇ‡∏ó‡∏£','‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£',''],
  soi:['‡∏ã‡∏≠‡∏¢','‡∏ã.','Soi',''],
  village:['‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô','‡∏°.','‡∏´‡∏°‡∏π‡πà',''],
  road:['‡∏ñ‡∏ô‡∏ô','‡∏ñ.','Rd.',''],
  subdistrict:['‡∏ï‡∏≥‡∏ö‡∏•','‡∏ï.',''],
  district:['‡∏≠‡∏≥‡πÄ‡∏†‡∏≠','‡∏≠.',''],
  province:['‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î','‡∏à.',''],
  postal:['‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏õ‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå','‡∏£‡∏´‡∏±‡∏™','Zip','']
};
const FuzzyLabels = {
  house:['‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡πÖ‡∏ó‡∏µ‡πà','‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏ã‡∏ó‡∏µ‡πà','‡∏ö‡πâ‡∏≤‡∏ô‡πÄx‡∏Ç‡∏ó‡∏µ‡πà','‡∏ö‡πâ‡∏≤u‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà'],
  phone:['‡πÇ‡∏ós‡∏±‡∏û‡∏ó‡πå','‡πÇ‡∏ó‡∏£s‡∏±s‡∏ó‡πå','‡πÇ‡∏óp‡∏®‡∏±‡∏û','‡πÇ‡∏ó‡∏£s‡∏±‡∏ö'],
  soi:['‡∏ão‡∏¢','‡∏ãx‡∏¢','‡∏ã0‡∏¢'],
  village:['‡∏´‡∏°‡∏π‡πà‡∏ö‡∏≤u','‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤u','‡∏´‡∏°‡∏πv‡∏ö‡∏≤u'],
  road:['‡∏ñu‡∏ô','‡∏ñuv','‡∏ñv‡∏ô'],
  subdistrict:['‡∏ï‡∏≥‡∏öu','‡∏ï‡πç‡∏≤‡∏ö‡∏•','‡∏ïx‡∏ö‡∏•'],
  district:['‡∏≠‡∏≥p‡∏≠','‡∏≠‡∏≥‡πÄ‡πÖ‡∏≠','‡∏≠‡πç‡∏≤‡πÄ‡∏†o'],
  province:['‡∏à‡∏±‡∏á‡∏´‡∏ß‡πâ‡∏î','‡∏à‡∏±n‡∏´‡∏ß‡∏±‡∏î','‡∏à‡∏±J‡∏´‡∏ß‡∏±‡∏î'],
  postal:['‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏õs‡∏©‡∏ì‡∏µ‡∏¢‡πå','‡∏£‡∏´‡∏±n‡πÑ‡∏õ‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå','‡∏£‡∏´‡∏±‡∏™‡πÑp‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå']
};
const Punct=['.',',','/','-','_'];

/* ====== Generator UI refs ====== */
const addressSelect=$('#addressSelect'), obfuscationSelect=$('#obfuscationSelect'), digitMode=$('#digitMode');
const spaceCount=$('#spaceCount'), spaceSample=$('#spaceSample'), randSpace=$('#randSpace'), nbspToggle=$('#nbspToggle');
const fuzzyLabels=$('#fuzzyLabels'), punctToggle=$('#punctToggle'), zwsToggle=$('#zwsToggle');
const resultDisplay=$('#resultDisplay'), generateCountEl=$('#generateCount'), copyCountEl=$('#copyCount'), currentVariationEl=$('#currentVariation'), generationTime=$('#generationTime');
const historyContainer=$('#historyContainer'), labelPreview=$('#labelPreview');

let PROFILES = loadProfiles();
function refreshProfileSelect(){
  addressSelect.innerHTML = Object.keys(PROFILES).map(k=>`<option value="${k}">${k}</option>`).join('');
}
function refreshProfileList(){
  const box=$('#profileList'); const keys=Object.keys(PROFILES);
  if(!keys.length){ box.innerHTML='<div class="tip">‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå</div>'; return; }
  box.innerHTML = keys.map(k=>{
    const p=PROFILES[k];
    return `<div class="item">
      <b>${k}</b>
      <div class="meta"><span>${esc([p.houseNumber,p.soi,p.village,p.road,p.subdistrict,p.district,p.province,p.postalCode].filter(Boolean).join(' ‚Ä¢ '))}</span></div>
    </div>`;
  }).join('');
}
refreshProfileSelect(); refreshProfileList();

/* ====== Label Preview ====== */
function renderLabelPreview(){
  const parts=['house','phone','soi','village','road','subdistrict','district','province','postal'];
  labelPreview.innerHTML = parts.map(k=>{
    const normal=rnd(Labels[k])||'‚Äî';
    const fuzzy = FuzzyLabels[k]? rnd(FuzzyLabels[k]) : '';
    return `<span class="chip">${normal}</span><span class="chip" style="opacity:.7">${fuzzy}</span>`;
  }).join(' ');
}
renderLabelPreview();

/* ====== Spacing Sample ====== */
function spacer(n,useNbsp){ return (useNbsp? '\\u00A0' : ' ').repeat(n) }
function updateSpaceSample(){
  const n=parseInt(spaceCount.value,10)||6;
  spaceSample.textContent = '_'.repeat(n);
}
spaceCount.addEventListener('input', updateSpaceSample); updateSpaceSample();

/* ====== Generator ====== */
const stats={ generateCount:0, copyCount:0 };
const history=[];

function rndChance(level){
  return {low:0, medium:.05, high:.15, extreme:.3}[level] || 0;
}
function injectPunc(str,level,enabled){
  if(!enabled) return str;
  const chance=rndChance(level); if(!chance) return str;
  let out=''; for(const ch of String(str)){ out+=ch; if(Math.random()<chance && ch!==' ' && !Punct.includes(ch)) out+=rnd(Punct); }
  return out;
}
function formatNumber(num){
  if(!num) return ''; const s=String(num);
  return rnd([s, s.replace('/',' / '), s.replace('/','-'), `No.${s}`, s.split('').join(' ')]);
}
function formatPhone(p){
  if(!p) return '';
  return rnd([
    p,
    p.replace(/(\\d{3})(\\d{3})(\\d{4})/,'$1-$2-$3'),
    p.replace(/(\\d{3})(\\d{3})(\\d{4})/,'$1 $2 $3'),
    '+66 '+p.slice(1)
  ]);
}
function variationCode(){ const A='ABCDEFGHIJKLMNOPQRSTUVWXYZ', D='0123456789'; return A[Math.floor(Math.random()*A.length)]+D[Math.floor(Math.random()*D.length)] }
function applyDigitMode(s){
  const v=digitMode.value; if(v==='thai') return toThaiDigits(s);
  if(v==='arabic') return toArabicDigits(s);
  return Math.random()<.5 ? toThaiDigits(s) : String(s);
}

function generateOneLine(){
  const t0=performance.now();
  const key=addressSelect.value; const p=PROFILES[key]; const level=obfuscationSelect.value;
  const parts = [];

  const house = `<span class="mark">${formatNumber(applyDigitMode(p.houseNumber||''))}</span>`;
  if(p.houseNumber) parts.push(randLabel('house',true)+house);
  if(p.phone) parts.push(randLabel('phone')+applyDigitMode(formatPhone(p.phone)));
  if(p.soi) parts.push(randLabel('soi')+p.soi);
  if(p.village) parts.push(randLabel('village')+p.village);
  if(p.road) parts.push(randLabel('road')+p.road);
  if(p.subdistrict) parts.push(randLabel('subdistrict')+p.subdistrict);
  if(p.district) parts.push(randLabel('district')+p.district);
  if(p.province) parts.push(randLabel('province')+p.province);
  if(p.postalCode) parts.push(randLabel('postal')+applyDigitMode(p.postalCode));

  // punctuation + zws (avoid affecting .mark segment)
  const processed = parts.map(x=>{
    let s = injectPunc(x, level, punctToggle.checked);
    if(zwsToggle.checked && level!=='low' && Math.random()<.35) s = zws(s);
    return s;
  });

  // single-line joiner: multiple spaces (no newline)
  const useNbsp = nbspToggle.checked;
  const base = parseInt(spaceCount.value,10)||6;
  const out = processed.join( processed.map((_,i)=> i<processed.length-1
    ? spacer(randSpace.checked ? (2+Math.floor(Math.random()*base)) : base, useNbsp)
    : ''
  ).join('') );

  stats.generateCount++; generateCountEl.textContent=stats.generateCount;
  const v=variationCode(); currentVariationEl.textContent=v;
  resultDisplay.innerHTML = out; // keep markup (.mark)
  generationTime.textContent = `${Math.max(1,Math.round(performance.now()-t0))}ms`;

  history.unshift({ id:Date.now(), v, text: out.replace(/<[^>]*>/g,''), at: new Date().toLocaleTimeString('th-TH') });
  if(history.length>8) history.pop();
  renderHistory();
}
function randLabel(type, required=false){
  let label = rnd(Labels[type]) || '';
  if(fuzzyLabels.checked && Math.random()<.45 && FuzzyLabels[type]?.length) label = rnd(FuzzyLabels[type]);
  const show = label && (required || Math.random()>.3);
  return show ? label+' ' : '';
}
function renderHistory(){
  if(!history.length){ historyContainer.innerHTML='<div class="tip">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</div>'; return; }
  historyContainer.innerHTML = history.map(h=>`
    <button class="item" data-hid="${h.id}">
      <div class="row" style="justify-content:space-between">
        <span class="chip">#${h.v}</span>
        <span class="tip">${h.at}</span>
      </div>
      <div class="tip" style="margin-top:6px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">${esc(h.text)}</div>
    </button>
  `).join('');
  $$('#historyContainer .item').forEach(el=>{
    el.addEventListener('click', ()=>{
      const id=+el.dataset.hid; const item=history.find(x=>x.id===id);
      if(item){ resultDisplay.textContent=item.text; showToast(`‡πÇ‡∏´‡∏•‡∏î‡∏à‡∏≤‡∏Å #${item.v}`); }
    });
  });
}
function cleanOutput(){
  const txt = (resultDisplay.textContent||'')
    .replace(/\u200b/g,'')                         // ZWSP
    .replace(/[.,/_-](?=\s)/g,'')                  // trailing punct before space
    .replace(/\s{2,}/g,' ');                       // collapse to single (‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å spaces ‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏≠‡∏á)
  resultDisplay.textContent = txt;
  showToast('‡∏•‡πâ‡∏≤‡∏á‡∏™‡∏±‡∏ç‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå/ZWSP ‡πÅ‡∏•‡πâ‡∏ß');
}
function exportCSV(){
  if(!history.length) return showToast('‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥');
  const rows = [['variation','time','text'], ...history.map(h=>[h.v,h.at,h.text.replace(/"/g,'""')])];
  const csv = rows.map(r=>r.map(c=>`"${String(c)}"`).join(',')).join('\n');
  const blob = new Blob([csv], {type:'text/csv;charset=utf-8'});
  const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='addresses.csv'; a.click(); URL.revokeObjectURL(a.href);
}
$('#generateBtn').addEventListener('click', generateOneLine);
$('#copyBtn').addEventListener('click', ()=>{
  const text = resultDisplay.textContent||''; if(!text.trim()) return showToast('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å');
  navigator.clipboard.writeText(text).then(()=>{ stats.copyCount++; copyCountEl.textContent=stats.copyCount; showToast('‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß ‚úÖ'); });
});
$('#saveBtn').addEventListener('click', ()=>{
  const text=resultDisplay.textContent||''; if(!text.trim()) return showToast('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å');
  const blob=new Blob([text],{type:'text/plain;charset=utf-8'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download=`address-${Date.now()}.txt`; a.click(); URL.revokeObjectURL(a.href);
});
$('#cleanBtn').addEventListener('click', cleanOutput);
$('#exportCsv').addEventListener('click', exportCSV);
[addressSelect,obfuscationSelect,digitMode,spaceCount,randSpace,nbspToggle,fuzzyLabels,punctToggle,zwsToggle]
  .forEach(el=> el.addEventListener('change', ()=>{ localStorage.setItem('neo_ctrl', JSON.stringify({
    a:addressSelect.value,o:obfuscationSelect.value,d:digitMode.value,s:spaceCount.value,r:randSpace.checked,nb:nbspToggle.checked,fz:fuzzyLabels.checked,pc:punctToggle.checked,zw:zwsToggle.checked
  })); }));

/* restore ctrl */
(function(){
  const c = JSON.parse(localStorage.getItem('neo_ctrl')||'{}');
  if(c.a && PROFILES[c.a]) addressSelect.value=c.a;
  if(c.o) obfuscationSelect.value=c.o;
  if(c.d) digitMode.value=c.d;
  if(c.s) spaceCount.value=c.s;
  if(typeof c.r==='boolean') randSpace.checked=c.r;
  if(typeof c.nb==='boolean') nbspToggle.checked=c.nb;
  if(typeof c.fz==='boolean') fuzzyLabels.checked=c.fz;
  if(typeof c.pc==='boolean') punctToggle.checked=c.pc;
  if(typeof c.zw==='boolean') zwsToggle.checked=c.zw;
  updateSpaceSample();
})();

/* First run */
refreshProfileSelect();
renderLabelPreview();
generateOneLine();

/* Keyboard shortcuts */
document.addEventListener('keydown',(e)=>{
  if(['INPUT','TEXTAREA'].includes(e.target.tagName)) return;
  if(e.key.toLowerCase()==='g') generateOneLine();
  if(e.key.toLowerCase()==='c'){ const t=resultDisplay.textContent||''; if(!t.trim()) return; navigator.clipboard.writeText(t).then(()=>{ stats.copyCount++; copyCountEl.textContent=stats.copyCount; showToast('‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß ‚úÖ'); }); }
});

/* ====== Settings: add/del profile ====== */
$('#addProfile').addEventListener('click', ()=>{
  const k=$('#p_key').value.trim(); if(!k) return showToast('‡πÉ‡∏™‡πà‡∏Ñ‡∏µ‡∏¢‡πå‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏Å‡πà‡∏≠‡∏ô');
  const p={
    houseNumber:$('#p_house').value.trim(),
    soi:$('#p_soi').value.trim(),
    village:$('#p_village').value.trim(),
    road:$('#p_road').value.trim(),
    subdistrict:$('#p_subdistrict').value.trim(),
    district:$('#p_district').value.trim(),
    province:$('#p_province').value.trim(),
    postalCode:$('#p_postal').value.trim(),
    phone:$('#p_phone').value.trim()
  };
  PROFILES[k]=p; saveUserProfiles(PROFILES); refreshProfileSelect(); refreshProfileList(); showToast('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏•‡πâ‡∏ß');
});
$('#delProfile').addEventListener('click', ()=>{
  const k=$('#p_key').value.trim(); if(!k) return showToast('‡πÉ‡∏™‡πà‡∏Ñ‡∏µ‡∏¢‡πå‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡∏ö');
  if(DEFAULT_PROFILES[k]) return showToast('‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏•‡∏ö‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ');
  if(PROFILES[k]){ delete PROFILES[k]; saveUserProfiles(PROFILES); refreshProfileSelect(); refreshProfileList(); showToast('‡∏•‡∏ö‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏•‡πâ‡∏ß'); }
});

/* ====== Firestore Board (Online) ====== */
const firebaseConfig = {
  apiKey: "AIzaSyAbD0PkshU9iNghvi-FCsV74PeR4aWzyQo",
  authDomain: "sent-9c549.firebaseapp.com",
  projectId: "sent-9c549",
  storageBucket: "sent-9c549.firebasestorage.app",
  messagingSenderId: "436570838998",
  appId: "1:436570838998:web:ec79c0496464ceabe33677"
};
let app, db, auth, me=null, unsub = null;

function initFirebase(){
  try{
    app = firebase.initializeApp(firebaseConfig);
    auth = firebase.auth();
    db = firebase.firestore();
    auth.onAuthStateChanged(async (u)=>{
      if(!u){ await auth.signInAnonymously(); return; }
      me = u; $('#loadingBoard').textContent = '‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÅ‡∏•‡πâ‡∏ß';
      // auto-connect board by URL ?board=
      const urlBoard = new URLSearchParams(location.search).get('board');
      if(urlBoard){ $('#boardIdInput').value = urlBoard; connectBoard(); }
      else {
        // restore last
        const last = localStorage.getItem('neo_board_id') || 'global-public';
        $('#boardIdInput').value = last; connectBoard();
      }
    });
  }catch(e){ console.error(e); $('#loadingBoard').textContent='‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ'; }
}
document.addEventListener('DOMContentLoaded', initFirebase);

/* Board UI refs */
const boardIdInput=$('#boardIdInput'), applyBoard=$('#applyBoard'), shareBoard=$('#shareBoard');
const titleInput=$('#titleInput'), messageInput=$('#messageInput'), charLeft=$('#charLeft'), postBtn=$('#postBtn'), clearCompose=$('#clearCompose');
const messagesEl=$('#messages'), loadingBoard=$('#loadingBoard'), searchMsg=$('#searchMsg'), onlyMine=$('#onlyMine');

messageInput.addEventListener('input', ()=>{ charLeft.textContent=String(1000 - messageInput.value.length); });
clearCompose.addEventListener('click', ()=>{ titleInput.value=''; messageInput.value=''; charLeft.textContent='1000'; });
applyBoard.addEventListener('click', connectBoard);
shareBoard.addEventListener('click', ()=>{
  const bid=(boardIdInput.value||'').trim()||'global-public';
  const url = `${location.origin}${location.pathname}?board=${encodeURIComponent(bid)}`;
  if(navigator.share){ navigator.share({title:'‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏ö‡∏≠‡∏£‡πå‡∏î', text:`Board: ${bid}`, url}); }
  else { navigator.clipboard.writeText(url).then(()=>showToast('‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÅ‡∏•‡πâ‡∏ß')); }
});

postBtn.addEventListener('click', async ()=>{
  if(!db || !me) return showToast('‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠');
  const text=(messageInput.value||'').trim(); if(!text) return showToast('‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡πà‡∏≠‡∏ô');
  const title=(titleInput.value||'').trim().slice(0,120);
  const bid=(boardIdInput.value||'').trim()||'global-public';
  try{
    await db.collection(`/boards/${bid}/messages`).add({
      text: text.slice(0,1000), title, timestamp: firebase.firestore.FieldValue.serverTimestamp(), authorId: me.uid
    });
    titleInput.value=''; messageInput.value=''; charLeft.textContent='1000';
  }catch(e){ console.error(e); showToast('‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß'); }
});

searchMsg.addEventListener('input', renderMsgs);
onlyMine.addEventListener('change', renderMsgs);

function connectBoard(){
  if(!db) return;
  const bid=(boardIdInput.value||'').trim()||'global-public';
  localStorage.setItem('neo_board_id', bid);
  $('#loadingBoard').textContent='‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...';
  if(unsub) unsub();
  unsub = db.collection(`/boards/${bid}/messages`).orderBy('timestamp','desc').onSnapshot(snap=>{
    $('#loadingBoard').textContent='';
    window._msgs = []; snap.forEach(d => window._msgs.push({ id:d.id, ...d.data() }));
    renderMsgs();
  }, err=>{ console.error(err); $('#loadingBoard').textContent='‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ'; });
}

function renderMsgs(){
  const q = (searchMsg.value||'').toLowerCase();
  const mine = onlyMine.checked ? me?.uid : null;
  const arr = (window._msgs||[])
    .filter(m => (!mine || m.authorId===mine))
    .filter(m => !q || (m.text||'').toLowerCase().includes(q) || (m.title||'').toLowerCase().includes(q));
  if(!arr.length){ messagesEl.innerHTML = '<div class="tip">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</div>'; return; }
  messagesEl.innerHTML = arr.map(m=>{
    const isMine = m.authorId && me && m.authorId===me.uid;
    const dateStr = m.timestamp?.toDate ? m.timestamp.toDate().toLocaleString('th-TH') : '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á...';
    return `<div class="item">
      ${m.title? `<div style="font-weight:700">${esc(m.title)}</div>`:''}
      <div style="white-space:pre-wrap;margin-top:4px">${esc(m.text)}</div>
      <div class="meta">
        <div>${esc(dateStr)}</div>
        <div class="row">
          <button class="btn btn-ghost" data-copy="${m.id}" style="padding:6px 10px;font-size:12px">‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å</button>
          ${isMine ? `<button class="btn btn-danger" data-del="${m.id}" style="padding:6px 10px;font-size:12px">‡∏•‡∏ö</button>`:''}
        </div>
      </div>
    </div>`;
  }).join('');
  // bind
  $$('#messages [data-copy]').forEach(b=>{
    b.addEventListener('click', ()=>{
      const id=b.dataset.copy; const m=(window._msgs||[]).find(x=>x.id===id); if(!m) return;
      navigator.clipboard.writeText(m.text||'').then(()=> showToast('‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏•‡πâ‡∏ß'));
    });
  });
  $$('#messages [data-del]').forEach(b=>{
    b.addEventListener('click', async ()=>{
      const id=b.dataset.del; const bid=(boardIdInput.value||'').trim()||'global-public';
      if(confirm('‡∏•‡∏ö‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')){
        try{ await db.doc(`/boards/${bid}/messages/${id}`).delete(); }
        catch(e){ console.error(e); showToast('‡∏•‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à'); }
      }
    });
  });
}

/* ====== Persist last controls and profiles to UI ====== */
(function initProfilesToSelect(){
  refreshProfileSelect();
  // if previously selected profile no longer exists, fallback to first
  const c = JSON.parse(localStorage.getItem('neo_ctrl')||'{}');
  if(c.a && PROFILES[c.a]) addressSelect.value=c.a;
  else addressSelect.value = Object.keys(PROFILES)[0];
})();

/* ====== Initial space sample + first render already called above ====== */
</script>
</body>
</html>
